<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Breaks down the elements of a data frame by one or more
 categorical elements and displays the breakdown as a bar plot."><title>Display a nested breakdown of numeric values — barNest • plotrix</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Display a nested breakdown of numeric values — barNest"><meta property="og:description" content="Breaks down the elements of a data frame by one or more
 categorical elements and displays the breakdown as a bar plot."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">plotrix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.8-6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/plotrix/plotrix/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Display a nested breakdown of numeric values</h1>
      
      <div class="d-none name"><code>barNest.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Breaks down the elements of a data frame by one or more
 categorical elements and displays the breakdown as a bar plot.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="cn">NULL</span>,data<span class="op">=</span><span class="cn">NULL</span>,FUN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>,<span class="st">"sd"</span>,<span class="st">"sd"</span>,<span class="st">"valid.n"</span><span class="op">)</span>,ylim<span class="op">=</span><span class="cn">NULL</span>,</span>
<span> main<span class="op">=</span><span class="st">""</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span>,shrink<span class="op">=</span><span class="fl">0.1</span>,errbars<span class="op">=</span><span class="cn">FALSE</span>,col<span class="op">=</span><span class="cn">NA</span>,</span>
<span> labelcex<span class="op">=</span><span class="fl">1</span>,lineht<span class="op">=</span><span class="cn">NULL</span>,showall<span class="op">=</span><span class="cn">TRUE</span>,Nwidths<span class="op">=</span><span class="cn">FALSE</span>,barlabels<span class="op">=</span><span class="cn">NULL</span>,</span>
<span> showlabels<span class="op">=</span><span class="cn">TRUE</span>,mar<span class="op">=</span><span class="cn">NULL</span>,arrow.cap<span class="op">=</span><span class="cn">NULL</span>,trueval<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>A formula with a numeric element of a data frame on the left and
  one or more categorical elements on the right.</p></dd>

 <dt>data</dt>
<dd><p>A data frame containing the elements in <samp>formula</samp>.</p></dd>

 <dt>FUN</dt>
<dd><p>The functions to apply to x.</p></dd>

 <dt>ylim</dt>
<dd><p>Optional y limits for the plot, usually necessary for counts.</p></dd>

 <dt>main</dt>
<dd><p>Title for the plot.</p></dd>

 <dt>xlab,ylab</dt>
<dd><p>Axis labels for the plot. The x axis label is typically blank</p></dd>

 <dt>shrink</dt>
<dd><p>The proportion to shrink the width of the bars at each level.</p></dd>

 <dt>errbars</dt>
<dd><p>Whether to display error bars on the lowest level of breakdown.</p></dd>

 <dt>col</dt>
<dd><p>The colors to use to fill the bars. See Details.</p></dd>

 <dt>labelcex</dt>
<dd><p>Character size for the group labels.</p></dd>

 <dt>lineht</dt>
<dd><p>The height of a line of text in the lower margin of the plot in user
  units. This will be calculated by the function if a value is not passed.</p></dd>

 <dt>showall</dt>
<dd><p>Whether to display bars for the entire breakdown.</p></dd>

 <dt>Nwidths</dt>
<dd><p>Whether to scale the widths of the bars to the number of
  observations.</p></dd>

 <dt>barlabels</dt>
<dd><p>Optional group labels that may be useful if the factors used to
  break down the numeric variable are fairly long strings.</p></dd>

 <dt>showlabels</dt>
<dd><p>Whether to display the labels below the bars.</p></dd>

 <dt>mar</dt>
<dd><p>If not NULL, a four element vector to set the plot margins. If new
  margins are set, the user must reset the margins after the function exits.</p></dd>

 <dt>arrow.cap</dt>
<dd><p>The width of the "cap" on error bars in user units,
  calculated on the basis of the number of bars in the final breakdown if NA.</p></dd>

 <dt>trueval</dt>
<dd><p>If this is not NA, the call to <samp>brkdnNest</samp> will return the
  proportions of the response variable that are equal to <samp>trueval</samp>.
  See Details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The summary list produced by brkdnNest.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><samp>barNest</samp> displays a bar plot illustrating the hierarchic breakdown of
 the elements of a data frame. The breakdown is performed by <samp>brkdnNest</samp>
 and the actual display is performed by <samp>drawNestedBars</samp>. The heights of
 the bars will be proportional to the values returned by the first function in
 <samp>FUN</samp>. If <samp>showall</samp> is TRUE, the entire nested breakdown will be
 displayed. This can be useful in visualizing the relationship between groups
 and subgroups in a compact format.</p>
<p><samp>barNest</samp> assumes that there will be four breakdowns in the list
 returned by <samp>brkdnNest</samp> in the order summary measure, upper dispersion
 value, lower dispersion value and number of valid observations. If
 <samp>Nwidths=FALSE</samp>, it may work with only three and if <samp>errbars=FALSE</samp>
 as well, it may work with only one.</p>
<p>If <samp>Nwidths=TRUE</samp>, the bar widths will be scaled to the relative number
 of observations per group. When the numbers of observations are very different,
 the labels for those bars with small numbers of observations will probably
 overlap.</p>
<p>A number of functions can be passed in the <samp>FUN</samp> argument. Three
 functions, <samp>propbrk</samp>, <samp>sumbrk</samp> and <samp>valid.n</samp> will work as
 summary measures, giving proportions or sums of particular values of a
 discrete variable and counts in each group and subgroup respectively.
 Binomial confidence limits can be added to the proportions returned by
 <samp>propbrk</samp> with <samp>binciWl</samp> and <samp>binciWu</samp> as in the second last
 example. If <samp>valid.n</samp> is the first element of <samp>FUN</samp>, the "overall"
 bar and label will be suppressed, as they are not informative. It is up to
 the user to decide whether any "error bars" displayed are meaningful.</p>
<p>The colors of the bars are determined by <samp>col</samp>. If <samp>showall</samp> is
 FALSE, the user only need pass a vector of colors, usually the same length
 as the number of categories in the final (last on the right side) element in
 the formula. If <samp>showall</samp> is TRUE and the user wants to color all of the
 bars, a list with as many elements as there are levels in the breakdown
 should be passed. Each element should be a vector of colors, again usually
 the same length as the number of categories. As the categorical variables are
 likely to be factors, it is important to remember that the colors must be in
 the correct order for the levels of the factors. When the levels are not in
 the default alphanumeric order, it is quite easy to get this wrong. As a
 <samp>barNest</samp> plot with more than a few factors and levels in each factor is
 quite dense, easily distinguished colors for each level of the breakdown may
 be preferable. As with some other plots, trying to cram too much information
 into a single illustration may not work well.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jim Lemon and Ofir Levy</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Lemon, J. &amp; Levy, O. (2011) barNest: Illustrating nested summary measures.
 Statistical Computing and Graphics Newsletter of the American Statistical
 Association, 21(2): 5-10.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="brkdnNest.html">brkdnNest</a>, <a href="drawNestedBars.html">drawNestedBars</a>, superbarplot(UsingR)</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span> <span class="co"># recreate the Titanic data frame and show the three way breakdown</span></span></span>
<span class="r-in"><span> <span class="va">titanic</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  class<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"1st"</span>,<span class="fl">325</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"2nd"</span>,<span class="fl">285</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"3rd"</span>,<span class="fl">706</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Crew"</span>,<span class="fl">885</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Adult"</span>,<span class="fl">319</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Child"</span>,<span class="fl">6</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Adult"</span>,<span class="fl">261</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Child"</span>,<span class="fl">24</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Adult"</span>,<span class="fl">627</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Child"</span>,<span class="fl">79</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Adult"</span>,<span class="fl">885</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">175</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="fl">144</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">168</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="fl">93</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">11</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="fl">13</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">462</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="fl">165</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">48</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="fl">31</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">862</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"F"</span>,<span class="fl">23</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  survived<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">57</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">118</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">140</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">4</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">14</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">154</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">80</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">13</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">24</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">75</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">387</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">76</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">89</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">13</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">35</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">14</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">17</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">192</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">670</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Yes"</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"No"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://plotrix.github.io/plotrix/" class="external-link">plotrix</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">titanic.colors</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"gray90"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#0000ff"</span>,<span class="st">"#7700ee"</span>,<span class="st">"#aa00cc"</span>,<span class="st">"#dd00aa"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ddcc00"</span>,<span class="st">"#ee9900"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pink"</span>,<span class="st">"lightblue"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span><span class="va">survived</span><span class="op">~</span><span class="va">class</span><span class="op">+</span><span class="va">age</span><span class="op">+</span><span class="va">sex</span>,<span class="va">titanic</span>,col<span class="op">=</span><span class="va">titanic.colors</span>,showall<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Titanic survival by class, age and sex"</span>,ylab<span class="op">=</span><span class="st">"Proportion surviving"</span>,</span></span>
<span class="r-in"><span>  FUN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"propbrk"</span>,<span class="st">"binciWu"</span>,<span class="st">"binciWl"</span>,<span class="st">"valid.n"</span><span class="op">)</span>,shrink<span class="op">=</span><span class="fl">0.15</span>,trueval<span class="op">=</span><span class="st">"Yes"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span><span class="va">survived</span><span class="op">~</span><span class="va">class</span><span class="op">+</span><span class="va">age</span><span class="op">+</span><span class="va">sex</span>,<span class="va">titanic</span>,col<span class="op">=</span><span class="va">titanic.colors</span>,showall<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Titanic survival by class, age and sex (scaled bar widths)"</span>,</span></span>
<span class="r-in"><span>  ylab<span class="op">=</span><span class="st">"Proportion surviving"</span>,FUN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"propbrk"</span>,<span class="st">"binciWu"</span>,<span class="st">"binciWl"</span>,<span class="st">"valid.n"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  shrink<span class="op">=</span><span class="fl">0.15</span>,trueval<span class="op">=</span><span class="st">"Yes"</span>,Nwidths<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="co"># now show the actual numbers of passengers</span></span></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span><span class="va">survived</span><span class="op">~</span><span class="va">class</span><span class="op">+</span><span class="va">age</span><span class="op">+</span><span class="va">sex</span>,<span class="va">titanic</span>,col<span class="op">=</span><span class="va">titanic.colors</span>,showall<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Titanic passengers and crew by class, age and sex"</span>,</span></span>
<span class="r-in"><span>  ylab<span class="op">=</span><span class="st">"Number"</span>,FUN<span class="op">=</span><span class="st">"valid.n"</span>,shrink<span class="op">=</span><span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="co"># to see this properly displayed, start a wide plot window</span></span></span>
<span class="r-in"><span> <span class="co"># x11(width=10)</span></span></span>
<span class="r-in"><span> <span class="va">test.df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">35</span>,<span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>,<span class="st">"Female"</span><span class="op">)</span>,<span class="fl">100</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Marital<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Div"</span>,<span class="st">"Mar"</span>,<span class="st">"Sing"</span>,<span class="st">"Wid"</span><span class="op">)</span>,<span class="fl">100</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Employ<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FT"</span>,<span class="st">"PT"</span>,<span class="st">"Un"</span><span class="op">)</span>,<span class="fl">100</span>,<span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">test.col</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Overall<span class="op">=</span><span class="st">"gray"</span>,Sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pink"</span>,<span class="st">"lightblue"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Marital<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mediumpurple"</span>,<span class="st">"orange"</span>,<span class="st">"tan"</span>,<span class="st">"lightgreen"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Employ<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#1affd8"</span>,<span class="st">"#caeecc"</span>,<span class="st">"#ff90d0"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">Age</span><span class="op">~</span><span class="va">Sex</span><span class="op">+</span><span class="va">Marital</span><span class="op">+</span><span class="va">Employ</span>,data<span class="op">=</span><span class="va">test.df</span>,ylab<span class="op">=</span><span class="st">"Mean age (years)"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Mean age by subgroups"</span>,errbars<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="va">test.col</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">Age</span><span class="op">~</span><span class="va">Sex</span><span class="op">+</span><span class="va">Marital</span><span class="op">+</span><span class="va">Employ</span>,data<span class="op">=</span><span class="va">test.df</span>,ylab<span class="op">=</span><span class="st">"Mean age (years)"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Mean age by subgroups (widths scaled to Ns)"</span>,errbars<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="va">test.col</span>,</span></span>
<span class="r-in"><span>  Nwidths<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="co"># set up functions for 20th and 80th percentiles</span></span></span>
<span class="r-in"><span> <span class="va">q20</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">na.rm</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>,probs<span class="op">=</span><span class="fl">0.2</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">q80</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">na.rm</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>,probs<span class="op">=</span><span class="fl">0.8</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># show the asymmetric dispersion measures</span></span></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">Age</span><span class="op">~</span><span class="va">Sex</span><span class="op">+</span><span class="va">Marital</span><span class="op">+</span><span class="va">Employ</span>,data<span class="op">=</span><span class="va">test.df</span>,ylab<span class="op">=</span><span class="st">"Mean age (years)"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Use median and quantiles for dispersion"</span>,</span></span>
<span class="r-in"><span>  FUN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>,<span class="st">"q80"</span>,<span class="st">"q20"</span>,<span class="st">"valid.n"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  errbars<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="va">test.col</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in q80(c(39.0946774325399, 31.7162999964641, 21.8123491454262, 27.723409761756, 31.0859287724658, 20.7758058573242, 45.8563528927088, 37.7419503747885, 29.4996614122259, 16.7994693011081, 26.2649872194945, 46.6664769720274, 33.1187679267339, 19.1097541581402, 30.4659451073173, 29.9003281053248, 49.7627366653935, 54.6421058906862, 49.1240995399472, 30.5167716621083, 23.8219647455367, 35.9057897402981, 35.0274677411236, 21.6120067981419, 44.6692431652679, 33.5972111395396, 40.0590753030518, 30.8253949642921, 26.9035012475394, 29.5544300325196, 18.7671604407578, 41.3862120649061, 21.5590930469805, 35.0554464143165, 39.2553551152163, 30.5694701441844, 46.533371517118, 24.6696662895564, 23.8011792580876, 43.9528481965231, 33.630985561499, 23.9485351550082, 41.8064958373098, 62.0358302291314, 64.136347297436, 45.9430719258765, 21.6462450392617, 33.5828707493713, 34.3029430530698, 40.1201549379355, 37.6358828683109, 32.3039779172673, 13.1593297101683, 51.5307221123074, 33.2366212093785, 22.5232708395764, 30.1014572286254, 11.9309295484517, 33.1295711004635, 36.7665707981339, 43.5761569495021, 38.2353395790036, 22.4821160322686, 26.847749628102, 22.5090700855503, 45.9975566705353, 39.1479726293717, 34.003259500595, 48.2342343032773, 36.9051479857822, 26.6168509415154, 22.7742262004619, 46.2003235048301, 35.9123624322653, 30.404842710069, 28.9192940826189, 34.132799931689, 22.8357085024525, 53.1517223096145, 25.1762244362755, 53.4881449254456, 25.4981950109455, 30.2423746126452, 16.7657705466173, 35.6944409485793, 42.1778870825645, 38.7702513277834, 36.4741054343906, 23.8849658446935, 18.7477038030886, 43.3084019022608, 14.6343534175619, 53.621883284297, 43.8882673471242, 8.29250733324533, 31.7017542782068, 36.8998674398789, 45.1089345646749, 44.3305300380335, 20.979148529647), na.rm = TRUE):</span> could not find function "q80"</span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">Employ</span><span class="op">~</span><span class="va">Sex</span><span class="op">+</span><span class="va">Marital</span>,data<span class="op">=</span><span class="va">test.df</span>,ylab<span class="op">=</span><span class="st">"Proportion unemployed"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Proportion unemployed by sex and marital status"</span>,</span></span>
<span class="r-in"><span>  FUN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"propbrk"</span>,<span class="st">"binciWu"</span>,<span class="st">"binciWl"</span>,<span class="st">"valid.n"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  errbars<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="va">test.col</span>,trueval<span class="op">=</span><span class="st">"Un"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">Employ</span><span class="op">~</span><span class="va">Sex</span><span class="op">+</span><span class="va">Marital</span>,data<span class="op">=</span><span class="va">test.df</span>,ylab<span class="op">=</span><span class="st">"Proportion unemployed"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Proportion unemployed by sex and marital status (scaled bar widths)"</span>,</span></span>
<span class="r-in"><span>  FUN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"propbrk"</span>,<span class="st">"binciWu"</span>,<span class="st">"binciWl"</span>,<span class="st">"valid.n"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  errbars<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="va">test.col</span>,trueval<span class="op">=</span><span class="st">"Un"</span>,Nwidths<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">Age</span><span class="op">~</span><span class="va">Sex</span><span class="op">+</span><span class="va">Marital</span><span class="op">+</span><span class="va">Employ</span>,data<span class="op">=</span><span class="va">test.df</span>,ylab<span class="op">=</span><span class="st">"Counts"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Show the counts in subgroups (final level only)"</span>,FUN<span class="op">=</span><span class="st">"valid.n"</span>,</span></span>
<span class="r-in"><span>  col<span class="op">=</span><span class="va">test.col</span>,showall<span class="op">=</span><span class="cn">FALSE</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> <span class="fu">barNest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">Age</span><span class="op">~</span><span class="va">Sex</span><span class="op">+</span><span class="va">Marital</span><span class="op">+</span><span class="va">Employ</span>,data<span class="op">=</span><span class="va">test.df</span>,ylab<span class="op">=</span><span class="st">"Counts"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Show all the counts in subgroups"</span>,FUN<span class="op">=</span><span class="st">"valid.n"</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  col<span class="op">=</span><span class="va">test.col</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="barNest-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jim Lemon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

